"use client";

import { useState } from "react";
import { Button } from "./ui/button";
import {
  Popover,
  PopoverContent,
  PopoverTrigger,
} from "./ui/popover";
import { Input } from "./ui/input";
import { Smile } from "lucide-react";

// Lista ampla de emojis organizados por categoria
const EMOJI_CATEGORIES = {
  "Finan√ßas": ["üí∞", "üíµ", "üí¥", "üí∂", "üí∑", "üí∏", "üí≥", "üíº", "üè¶", "üìä", "üìà", "üìâ", "üíπ", "üí≤", "ü™ô", "üí±", "üí≤", "üí≥", "üßæ", "üìã"],
  "Alimenta√ß√£o": ["üçî", "üçï", "üçü", "üå≠", "üçø", "üßÇ", "ü•ì", "üç≥", "ü•û", "üßá", "ü•ê", "ü•®", "üßÄ", "ü•ñ", "ü•Ø", "üçû", "ü•™", "üåÆ", "üåØ", "ü•ô", "ü•ó", "üçù", "üçú", "üç≤", "üçõ", "üç£", "üç±", "üçò", "üçô", "üçö", "üç•", "ü•Æ", "üç¢", "üç°", "üçß", "üç®", "üç©", "üç™", "üéÇ", "üç∞", "üßÅ", "üç´", "üç¨", "üç≠", "üçÆ", "üçØ", "üçº", "ü•õ", "‚òï", "üçµ", "üßÉ", "ü•§", "üç∂", "üç∫", "üçª", "ü•Ç", "üç∑", "ü•É", "üç∏", "üçπ", "üßâ", "üßä"],
  "Transporte": ["üöó", "üöï", "üöô", "üöå", "üöé", "üèéÔ∏è", "üöì", "üöë", "üöí", "üöê", "üõª", "üöö", "üöõ", "üöú", "üõ¥", "üö≤", "üõµ", "üèçÔ∏è", "üõ∫", "üö®", "üöî", "üöç", "üöò", "üöñ", "üö°", "üö†", "üöü", "üöÉ", "üöã", "üöû", "üöù", "üöÑ", "üöÖ", "üöà", "üöÇ", "üöÜ", "üöá", "üöä", "üöâ", "‚úàÔ∏è", "üõ´", "üõ¨", "üõ©Ô∏è", "üí∫", "üöÅ", "üöü", "üö†", "üö°", "üõ∏", "üöÄ", "üõ∞Ô∏è", "üí∫", "üö¢", "‚õµ", "üõ•Ô∏è", "üõ≥Ô∏è", "‚õ¥Ô∏è", "üö§", "üõ∂", "üõü", "‚õΩ", "üöß", "üö¶", "üö•", "üó∫Ô∏è", "üß≠"],
  "Casa & Moradia": ["üè†", "üè°", "üèòÔ∏è", "üèöÔ∏è", "üèóÔ∏è", "üè≠", "üè¢", "üè¨", "üè£", "üè§", "üè•", "üè¶", "üè®", "üè™", "üè´", "üè©", "üíí", "üèõÔ∏è", "‚õ™", "üïå", "üïç", "üõï", "üïã", "‚õ©Ô∏è", "üõ§Ô∏è", "üõ£Ô∏è", "üóæ", "üéë", "üèûÔ∏è", "üåÖ", "üåÑ", "üå†", "üéá", "üéÜ", "üåá", "üåÜ", "üèôÔ∏è", "üåÉ", "üåå", "üåâ", "üåÅ"],
  "Compras & Com√©rcio": ["üõí", "üõçÔ∏è", "üõéÔ∏è", "üß≥", "‚åõ", "‚è≥", "‚åö", "‚è∞", "‚è±Ô∏è", "‚è≤Ô∏è", "üï∞Ô∏è", "üå°Ô∏è", "üóø", "üõçÔ∏è", "üõí", "üéÅ", "üéÄ", "üéóÔ∏è", "üè∑Ô∏è", "üé´", "üéüÔ∏è", "üé™", "ü§π", "üé≠", "ü©∞", "üé®", "üñºÔ∏è", "üé®", "üëì", "üï∂Ô∏è", "ü•Ω", "ü•º", "ü¶∫", "üëî", "üëï", "üëñ", "üß£", "üß§", "üß•", "üß¶", "üëó", "üëò", "ü•ª", "ü©±", "ü©≤", "ü©≥", "üëô", "üëö", "üëõ", "üëú", "üëù", "üõçÔ∏è", "üéí", "üëû", "üëü", "ü•æ", "ü•ø", "üë†", "üë°", "ü©¥", "üë¢", "üëë", "üëí", "üé©", "üéì", "üß¢", "‚õëÔ∏è", "ü™ñ", "üíÑ", "üíç", "üíé"],
  "Sa√∫de & Bem-estar": ["üè•", "‚öïÔ∏è", "ü©∫", "üíä", "üíâ", "ü©∏", "üß¨", "ü¶†", "üß´", "üß™", "üå°Ô∏è", "ü¶∑", "ü¶¥", "üíÄ", "üëÅÔ∏è", "üëÄ", "üß†", "ü´Ä", "ü´Å", "ü¶µ", "ü¶∂", "üëÇ", "ü¶ª", "üëÉ", "üëÑ", "üíã", "üíÖ", "ü§≥", "üí™", "ü¶æ", "ü¶ø", "ü¶µ", "ü¶∂", "üë§", "üë•", "ü´Ç", "üë∂", "üëß", "üßí", "üë¶", "üë©", "üßë", "üë®", "üë©‚Äçü¶±", "üë®‚Äçü¶±", "üë©‚Äçü¶∞", "üë®‚Äçü¶∞", "üë±‚Äç‚ôÄÔ∏è", "üë±", "üë©‚Äçü¶≥", "üë®‚Äçü¶≥", "üë©‚Äçü¶≤", "üë®‚Äçü¶≤", "üßî", "üëµ", "üßì", "üë¥", "üë≤", "üë≥‚Äç‚ôÄÔ∏è", "üë≥", "üßï", "üëÆ‚Äç‚ôÄÔ∏è", "üëÆ", "üë∑‚Äç‚ôÄÔ∏è", "üë∑", "üíÇ‚Äç‚ôÄÔ∏è", "üíÇ", "üïµÔ∏è‚Äç‚ôÄÔ∏è", "üïµÔ∏è", "üë©‚Äç‚öïÔ∏è", "üë®‚Äç‚öïÔ∏è", "üë©‚Äçüåæ", "üë®‚Äçüåæ", "üë©‚Äçüç≥", "üë®‚Äçüç≥", "üë©‚Äçüéì", "üë®‚Äçüéì", "üë©‚Äçüé§", "üë®‚Äçüé§", "üë©‚Äçüè´", "üë®‚Äçüè´", "üë©‚Äçüè≠", "üë®‚Äçüè≠", "üë©‚Äçüíª", "üë®‚Äçüíª", "üë©‚Äçüíº", "üë®‚Äçüíº", "üë©‚Äçüîß", "üë®‚Äçüîß", "üë©‚Äçüî¨", "üë®‚Äçüî¨", "üë©‚Äçüé®", "üë®‚Äçüé®", "üë©‚Äçüöí", "üë®‚Äçüöí", "üë©‚Äç‚úàÔ∏è", "üë®‚Äç‚úàÔ∏è", "üë©‚ÄçüöÄ", "üë®‚ÄçüöÄ", "üë©‚Äç‚öñÔ∏è", "üë®‚Äç‚öñÔ∏è", "ü§∂", "üéÖ", "üë∏", "ü§¥", "üë∞", "ü§µ", "üëº", "ü§∞", "üôá", "üíÅ", "üôÖ", "üôÜ", "üôã", "üßè", "ü§¶", "ü§∑", "üôé", "üôç", "üíá", "üíÜ", "üßñ", "üíÉ", "üï∫", "üï¥Ô∏è", "üëØ", "üßò", "üõÄ", "üõå", "üßô", "üßõ", "üßú", "üßù", "üßû", "üßü", "üíÜ", "üíá", "üö∂", "üèÉ", "üßç", "üßé", "üë´", "üë≠", "üë¨", "üíè", "üíë", "üë™", "üë®‚Äçüë©‚Äçüëß", "üë®‚Äçüë©‚Äçüëß‚Äçüë¶", "üë®‚Äçüë©‚Äçüë¶‚Äçüë¶", "üë®‚Äçüë©‚Äçüëß‚Äçüëß", "üë©‚Äçüë©‚Äçüë¶", "üë©‚Äçüë©‚Äçüëß", "üë©‚Äçüë©‚Äçüëß‚Äçüë¶", "üë©‚Äçüë©‚Äçüë¶‚Äçüë¶", "üë©‚Äçüë©‚Äçüëß‚Äçüëß", "üë®‚Äçüë®‚Äçüë¶", "üë®‚Äçüë®‚Äçüëß", "üë®‚Äçüë®‚Äçüëß‚Äçüë¶", "üë®‚Äçüë®‚Äçüë¶‚Äçüë¶", "üë®‚Äçüë®‚Äçüëß‚Äçüëß", "üë©‚Äçüë¶", "üë©‚Äçüëß", "üë©‚Äçüëß‚Äçüë¶", "üë©‚Äçüë¶‚Äçüë¶", "üë©‚Äçüëß‚Äçüëß", "üë®‚Äçüë¶", "üë®‚Äçüëß", "üë®‚Äçüëß‚Äçüë¶", "üë®‚Äçüë¶‚Äçüë¶", "üë®‚Äçüëß‚Äçüëß", "üëö", "üëï", "üëñ", "ü©≤", "ü©≥", "üëî", "üëó", "üëô", "üëò", "ü•ª", "ü©±", "ü•º", "ü¶∫", "üß•", "üß¶", "üß§", "üß£", "ü©¥", "üë°", "üë†", "ü•æ", "ü•ø", "üë¢", "üëû", "üëü", "ü¶∂", "ü¶µ", "ü¶ø", "ü¶æ", "üß†", "ü¶∑", "ü¶¥", "üëÄ", "üëÅÔ∏è", "üëÖ", "üëÑ", "üíã", "ü©∏"],
  "Entretenimento": ["üé¨", "üéûÔ∏è", "üìΩÔ∏è", "üé•", "üìπ", "üì∑", "üì∏", "üì±", "üì≤", "üíª", "‚å®Ô∏è", "üñ•Ô∏è", "üñ®Ô∏è", "üñ±Ô∏è", "üñ≤Ô∏è", "üïπÔ∏è", "üóúÔ∏è", "üíæ", "üíø", "üìÄ", "üìº", "üì∑", "üì∏", "üìπ", "üé•", "üìΩÔ∏è", "üéûÔ∏è", "üìû", "‚òéÔ∏è", "üìü", "üì†", "üì∫", "üìª", "üéôÔ∏è", "üéöÔ∏è", "üéõÔ∏è", "‚è±Ô∏è", "‚è≤Ô∏è", "‚è∞", "üï∞Ô∏è", "‚åõ", "‚è≥", "üì°", "üîã", "üîå", "üí°", "üî¶", "üïØÔ∏è", "ü™î", "üßØ", "üõ¢Ô∏è", "üí∏", "üíµ", "üí¥", "üí∂", "üí∑", "üí∞", "üí≥", "üíé", "‚öñÔ∏è", "üõ†Ô∏è", "üîß", "üî®", "‚öíÔ∏è", "üõ†Ô∏è", "‚õèÔ∏è", "üî©", "‚öôÔ∏è", "ü™ö", "üß∞", "üß≤", "ü™ú", "ü™§", "üî´", "üí£", "üß®", "üéØ", "üé≤", "üÉè", "üÄÑ", "üé¥", "üéÆ", "üïπÔ∏è", "üé∞", "üß©", "‚ô†Ô∏è", "‚ô•Ô∏è", "‚ô¶Ô∏è", "‚ô£Ô∏è", "‚ôüÔ∏è", "üÉè", "üÄÑ", "üé¥", "üé≠", "üñºÔ∏è", "üé®", "üßµ", "ü™°", "üß∂", "ü™¢", "üëì", "üï∂Ô∏è", "ü•Ω", "ü•º", "ü¶∫", "üëî", "üëï", "üëñ", "üß£", "üß§", "üß•", "üß¶", "üëó", "üëò", "ü•ª", "ü©±", "ü©≤", "ü©≥", "üëô", "üëö", "üëõ", "üëú", "üëù", "üõçÔ∏è", "üéí", "üëû", "üëü", "ü•æ", "ü•ø", "üë†", "üë°", "ü©¥", "üë¢", "üëë", "üëí", "üé©", "üéì", "üß¢", "‚õëÔ∏è", "ü™ñ", "üíÑ", "üíç", "üíé", "üîá", "üîà", "üîâ", "üîä", "üì¢", "üì£", "üìØ", "üîî", "üîï", "üéº", "üéµ", "üé∂", "üéôÔ∏è", "üéöÔ∏è", "üéõÔ∏è", "üé§", "üéß", "üìª", "üé∑", "ü™ó", "üé∏", "üéπ", "üé∫", "üéª", "ü™ï", "ü•Å", "ü™ò", "üé≤", "‚ôüÔ∏è", "üéØ", "üé≥", "üéÆ", "üé∞", "üß©"],
  "Educa√ß√£o": ["üéì", "üìö", "üìñ", "üìó", "üìò", "üìô", "üìï", "üìì", "üìí", "üìÉ", "üìú", "üìÑ", "üìë", "üßæ", "üìä", "üìà", "üìâ", "üóíÔ∏è", "üóìÔ∏è", "üìÜ", "üìÖ", "üóëÔ∏è", "üìá", "üóÉÔ∏è", "üó≥Ô∏è", "üóÑÔ∏è", "üìã", "üìÅ", "üìÇ", "üóÇÔ∏è", "üóûÔ∏è", "üì∞", "üìì", "üìî", "üìí", "üìï", "üìó", "üìò", "üìô", "üìö", "üìñ", "üîñ", "üß∑", "üîó", "üìé", "üñáÔ∏è", "üìê", "üìè", "üßÆ", "üìå", "üìç", "‚úÇÔ∏è", "üñäÔ∏è", "üñãÔ∏è", "‚úíÔ∏è", "üñåÔ∏è", "üñçÔ∏è", "üìù", "‚úèÔ∏è", "üîç", "üîé", "üõ†Ô∏è", "üîß", "üî®", "‚öíÔ∏è", "üõ†Ô∏è", "‚õèÔ∏è", "üî©", "‚öôÔ∏è", "üß∞", "üß≤", "ü™ú", "ü™§", "üî´", "üí£", "üß®", "üî™", "üó°Ô∏è", "‚öîÔ∏è", "üõ°Ô∏è", "üö¨", "‚ö∞Ô∏è", "ü™¶", "‚ö±Ô∏è", "üè∫", "üîÆ", "üìø", "üßø", "üíà", "‚öóÔ∏è", "üî≠", "üî¨", "üï≥Ô∏è", "ü©π", "ü©∫", "üíä", "üíâ", "ü©∏", "üß¨", "ü¶†", "üß´", "üß™", "üå°Ô∏è", "üßπ", "ü™†", "üß∫", "üßª", "üöΩ", "üö∞", "üöø", "üõÅ", "üõÄ", "üßº", "ü™•", "ü™í", "üßΩ", "ü™£", "üß¥", "üõéÔ∏è", "üîë", "üóùÔ∏è", "üö™", "ü™ë", "üõãÔ∏è", "üõèÔ∏è", "üõå", "üß∏", "ü™Ü", "ü™Ö", "ü™Ü", "ü™á", "ü™à", "ü™â", "ü™ä", "ü™ã", "ü™å", "ü™ç", "ü™é", "ü™è", "ü™ê", "ü™ë", "ü™í", "ü™ì", "ü™î", "ü™ï", "ü™ñ", "ü™ó", "ü™ò", "ü™ô", "ü™ö", "ü™õ", "ü™ú", "ü™ù", "ü™û", "ü™ü", "ü™†", "ü™°", "ü™¢", "ü™£", "ü™§", "ü™•", "ü™¶", "ü™ß", "ü™®", "ü™©", "ü™™", "ü™´", "ü™¨", "ü™≠", "ü™Æ", "ü™Ø", "ü™∞", "ü™±", "ü™≤", "ü™≥", "ü™¥", "ü™µ", "ü™∂", "ü™∑", "ü™∏", "ü™π", "ü™∫", "ü™ª", "ü™º", "ü™Ω", "ü™æ", "ü™ø", "ü´Ä", "ü´Å", "ü´Ç", "ü´É", "ü´Ñ", "ü´Ö", "ü´Ü", "ü´á", "ü´à", "ü´â", "ü´ä", "ü´ã", "ü´å", "ü´ç", "ü´é", "ü´è", "ü´ê", "ü´ë", "ü´í", "ü´ì", "ü´î", "ü´ï", "ü´ñ"],
  "Outros": ["‚≠ê", "üåü", "üí´", "‚ú®", "‚ö°", "‚òÑÔ∏è", "üí•", "üî•", "üå™Ô∏è", "üåà", "‚òÄÔ∏è", "üå§Ô∏è", "‚õÖ", "üå•Ô∏è", "‚òÅÔ∏è", "üå¶Ô∏è", "üåßÔ∏è", "‚õàÔ∏è", "üå©Ô∏è", "‚ö°", "‚ùÑÔ∏è", "‚òÉÔ∏è", "‚õÑ", "üå®Ô∏è", "üíß", "‚òî", "‚òÇÔ∏è", "üåä", "üå´Ô∏è", "üçÉ", "üçÇ", "üçÅ", "üçÑ", "üåæ", "üíê", "üå∑", "üåπ", "ü•Ä", "üå∫", "üå∏", "üåº", "üåª", "üåû", "üåù", "üåõ", "üåú", "üåö", "üåï", "üåñ", "üåó", "üåò", "üåë", "üåí", "üåì", "üåî", "üåô", "üåé", "üåç", "üåè", "ü™ê", "üí´", "‚≠ê", "üåü", "‚ú®", "‚ö°", "‚òÑÔ∏è", "üí•", "üî•", "üå™Ô∏è", "üåà", "‚òÄÔ∏è", "üå§Ô∏è", "‚õÖ", "üå•Ô∏è", "‚òÅÔ∏è", "üå¶Ô∏è", "üåßÔ∏è", "‚õàÔ∏è", "üå©Ô∏è", "‚ö°", "‚ùÑÔ∏è", "‚òÉÔ∏è", "‚õÑ", "üå®Ô∏è", "üíß", "‚òî", "‚òÇÔ∏è", "üåä", "üå´Ô∏è"],
};

interface EmojiPickerProps {
  value?: string | null;
  onChange: (emoji: string) => void;
  placeholder?: string;
}

export function EmojiPicker({
  value,
  onChange,
  placeholder = "Ex: üè†, üí∞, ‚úàÔ∏è",
}: EmojiPickerProps) {
  const [isOpen, setIsOpen] = useState(false);
  const [searchTerm, setSearchTerm] = useState("");

  // Mapeamento de palavras-chave para categorias (para busca)
  const categoryKeywords: Record<string, string[]> = {
    "Objetos": ["casa", "dinheiro", "cart√£o", "celular", "computador", "carro", "avi√£o", "anel", "presente", "livro"],
    "Metas": ["meta", "objetivo", "trof√©u", "diamante", "estrela", "fogo", "foguete", "celebra√ß√£o"],
    "Finan√ßas": ["dinheiro", "banco", "gr√°fico", "moeda", "d√≥lar", "euro", "yen"],
    "Viagens": ["viagem", "mundo", "mapa", "mala", "praia", "montanha", "navio", "trem"],
    "Casa": ["casa", "im√≥vel", "edif√≠cio", "constru√ß√£o"],
    "Educa√ß√£o": ["estudo", "livro", "escola", "universidade", "caneta", "ci√™ncia"],
  };

  // Filtrar categorias e emojis baseado na busca
  const getFilteredCategories = () => {
    if (!searchTerm.trim()) {
      return EMOJI_CATEGORIES;
    }

    const searchLower = searchTerm.toLowerCase();
    const filtered: typeof EMOJI_CATEGORIES = {};

    Object.entries(EMOJI_CATEGORIES).forEach(([category, emojis]) => {
      const keywords = categoryKeywords[category] || [];
      const matchesCategory = 
        category.toLowerCase().includes(searchLower) ||
        keywords.some((keyword) => keyword.includes(searchLower));
      
      if (matchesCategory) {
        filtered[category] = emojis;
      }
    });

    return filtered;
  };

  const filteredCategories = getFilteredCategories();

  const handleEmojiSelect = (emoji: string) => {
    onChange(emoji);
    setIsOpen(false);
    setSearchTerm("");
  };

  return (
    <div className="flex gap-2">
      <Popover open={isOpen} onOpenChange={setIsOpen}>
        <PopoverTrigger asChild>
          <Button
            type="button"
            variant="outline"
            size="icon"
            className="h-9 w-9 shrink-0 text-lg"
            title="Escolher emoji"
          >
            {value || <Smile className="h-4 w-4" />}
          </Button>
        </PopoverTrigger>
        <PopoverContent className="w-80 p-0" align="start">
          <div className="p-3">
            <Input
              placeholder="Buscar emoji..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="mb-3"
            />
            <div className="max-h-[300px] overflow-y-auto">
              {Object.keys(filteredCategories).length === 0 ? (
                <div className="py-8 text-center text-sm text-muted-foreground">
                  Nenhum emoji encontrado
                </div>
              ) : (
                Object.entries(filteredCategories).map(([category, emojis]) => (
                  <div key={category} className="mb-4">
                    <h4 className="mb-2 text-xs font-semibold text-muted-foreground">
                      {category}
                    </h4>
                    <div className="grid grid-cols-8 gap-2">
                      {emojis.map((emoji, index) => (
                        <button
                          key={`${category}-${index}`}
                          type="button"
                          onClick={() => handleEmojiSelect(emoji)}
                          className="flex h-10 w-10 items-center justify-center rounded-md border bg-background text-lg transition-colors hover:bg-accent hover:text-accent-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"
                          title={emoji}
                        >
                          {emoji}
                        </button>
                      ))}
                    </div>
                  </div>
                ))
              )}
            </div>
          </div>
        </PopoverContent>
      </Popover>
      <Input
        placeholder={placeholder}
        value={value || ""}
        onChange={(e) => onChange(e.target.value)}
        className="flex-1"
      />
    </div>
  );
}

